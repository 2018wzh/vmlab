# VMLab 虚拟化实验平台 - 详细实现路线图

## 项目概述
VMLab是一个基于Django和Libvirt的现代化虚拟机实验平台，专为教育环境设计。本文档详细描述了项目的实现步骤和开发计划。

### 📋 下一步计划
1. 完成核心UI组件库开发
2. 实现用户管理界面
3. 开发虚拟机管理界面
4. 集成noVNC Web控制台
5. 实现实时状态更新和WebSocket支持

## 开发阶段规划

### 第一阶段：基础设施搭建 📋

#### 1.1 项目环境初始化
- [x] **Django项目配置**
  - [x] 创建Django项目结构
  - [x] 配置settings.py（数据库、静态文件等）
  - [x] 配置URL路由
  - [x] 设置日志系统

- [x] **数据库设计**
  - [x] 设计用户模型（扩展Django User模型）
  - [x] 设计角色权限模型
  - [x] 设计课程相关模型
  - [x] 设计虚拟机相关模型
  - [x] 设计任务队列模型
  - [x] 创建数据库迁移文件

- [x] **Docker容器化**
  - [x] 编写Dockerfile
  - [x] 创建docker-compose.yml

### 第二阶段：用户管理系统 👥
#### 2.1 用户认证与授权
- [x] **基础用户功能**
  - [x] 用户注册功能
  - [x] 用户登录/登出功能

- [x] **角色权限系统**
  - [x] 定义角色模型（学生、教师、管理员）
  - [x] 实现基于角色的权限控制
  - [x] 创建权限装饰器
  - [x] 实现资源访问控制

#### 2.2 用户管理界面
- [ ] **管理员界面**
  - [x] 用户列表展示 (后端)
  - [x] 用户创建/编辑功能 (后端)
  - [x] 用户状态管理 (后端)
  - [ ] 用户搜索和过滤

- [x] **资源配额管理**
  - [x] 设计配额模型
  - [x] 实现CPU配额控制 (后端)
  - [x] 实现内存配额控制 (后端)
  - [x] 实现磁盘配额控制 (后端)

### 第三阶段：课程管理模块 📚
#### 3.1 课程基础功能
- [x] **课程CRUD操作**
  - [x] 课程创建功能
  - [x] 课程信息编辑
  - [x] 课程列表展示
  - [x] 课程删除功能
  - [x] 课程状态管理

- [x] **课程-用户关联**
  - [x] 学生选课功能
  - [x] 教师课程分配
  - [x] 课程成员管理
  - [x] 权限继承机制

#### 3.2 虚拟机模板管理
- [x] **模板上传功能**
  - [x] qcow2文件上传接口
  - [x] 文件完整性验证
  - [x] 模板元数据管理

- [x] **模板分配系统**
  - [x] 课程模板关联
  - [x] 学生模板访问权限


### 第四阶段：虚拟机管理核心 💻 ✅ **已完成**
#### 4.1 Libvirt集成 ✅
- [x] **虚拟化后端**
  - [x] Libvirt Python API集成
  - [x] KVM/QEMU支持
  - [x] 虚拟机配置管理（XML生成）
  - [x] 网络配置管理（MAC地址生成）
  - [x] 存储管理（qcow2磁盘）

- [x] **虚拟机操作**
  - [x] 虚拟机创建（异步处理）
  - [x] 虚拟机启动/停止
  - [x] 虚拟机暂停/恢复
  - [x] 虚拟机重启
  - [x] 虚拟机删除（含磁盘清理）

#### 4.2 资源监控 ✅
- [x] **实时监控**
  - [x] CPU使用率监控
  - [x] 内存使用监控
  - [x] 磁盘I/O监控
  - [x] 网络流量监控
  - [x] 虚拟机状态监控

- [x] **虚拟机服务层**
  - [x] 服务层架构设计
  - [x] 异步任务处理（线程池）
  - [x] 错误处理和状态管理
  - [x] 资源配额验证

#### 4.3 控制台访问 ✅
- [x] **VNC控制台**
  - [x] VNC端口管理
  - [x] VNC密码生成
  - [x] 控制台访问API

#### 4.4 虚拟机管理API ✅
- [x] **REST API**
  - [x] 虚拟机CRUD操作
  - [x] 虚拟机控制操作（启动/停止/重启等）
  - [x] 虚拟机状态查询
  - [x] 虚拟机监控数据API
  - [x] 控制台访问API
  - [x] 权限控制（基于角色）

#### 4.6 WebSSH控制台
- [ ] **WebSSH集成**

### 第五阶段：前端界面开发 🎨
#### 5.1 基础架构与UI框架
- [x] **前端框架选型与搭建**
  - [x] React + Next.js
  - [x] 初始化前端项目结构(yarn)
  - [x] 集成 Material Design 组件库
- [x] **核心服务配置**
  - [ ] 配置路由管理 (React Router)
  - [x] 配置状态管理 (Redux Toolkit)
  - [x] 封装 `axios` 用于API请求

#### 5.2 核心UI组件库开发
- [ ] 开发 `StatusChip` 状态指示器
- [ ] 开发 `ResourceDonutChart` 资源环形图
- [ ] 开发 `DataTable` 数据表格组件
- [ ] 开发 `ConfirmDialog` 确认对话框
- [ ] 开发 `FileUploader` 文件上传组件
- [ ] 开发 `PageHeader` 统一页面头部

#### 5.3 基础页面与布局
- [ ] **主布局**
  - [ ] 实现顶部应用栏 (AppBar)
  - [ ] 实现左侧导航栏 (Navigation Drawer)，并根据角色动态生成
- [ ] **认证页面**
  - [ ] 实现用户登录页面
  - [ ] 实现用户注册页面

#### 5.4 功能模块界面开发
- [ ] **主仪表盘 (Dashboard)**
  - [ ] 实现基于角色的卡片式布局
  - [ ] 学生视图：资源配额、虚拟机列表
  - [ ] 教师视图：课程概览、学生虚拟机统计
  - [ ] 管理员视图：系统状态、资源总览
- [ ] **虚拟机管理**
  - [ ] 实现虚拟机列表页 (包含搜索、筛选)
  - [ ] 实现创建虚拟机向导 (`CreateVMWizard`)
  - [ ] 实现虚拟机详情页
    - [ ] 监控图表 (实时数据)
    - [ ] noVNC/WebSSH 控制台集成
    - [ ] 快照管理
    - [ ] 设置
- [ ] **课程管理**
  - [ ] 实现课程列表页
  - [ ] 实现课程详情页 (学生管理、模板管理)
- [ ] **用户管理 (管理员)**
  - [ ] 实现用户列表页
  - [ ] 实现用户创建/编辑/配额分配功能

#### 5.5 API全面集成
- [ ] 对接用户认证和管理API
- [ ] 对接课程管理API
- [ ] 对接虚拟机管理API (CRUD, 操作, 监控)
- [ ] 实现WebSocket或长轮询，用于虚拟机状态的实时更新

### 第六阶段：系统优化与部署 🚀
#### 6.1 文档编写
- [ ] **技术文档**
  - [ ] API文档
  - [ ] 架构设计文档
  - [ ] 部署指南
  - [ ] 开发规范

- [ ] **用户文档**
  - [ ] 用户手册
  - [ ] 管理员指南
  - [ ] 常见问题解答
  - [ ] 视频教程
