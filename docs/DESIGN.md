# VMLab 前端设计文档

## 1. 技术栈选择

### 1.1 核心框架
- **Vue.js**: 用于构建用户界面的渐进式框架
- **Vuetify**: Material Design组件库
- **Axios**: HTTP请求处理
- **Vuex**: 状态管理

### 1.2 开发工具
- **Vite**: 构建工具
- **TypeScript**: 类型检查
- **ESLint**: 代码质量控制
- **Prettier**: 代码格式化

## 2. 整体布局设计

### 2.1 布局结构
```
+------------------+--------------------------------+
|      VMLAB      |            用户信息            |
+------------------+--------------------------------+
|                 |                                |
|   侧边导航栏    |          内容区域             |
|   [固定宽度]    |      [自适应宽度]             |
|                 |                                |
|   - 仪表盘      |                                |
|   - 课程        |                                |
|   - 虚拟机      |                                |
|   - 设置        |                                |
|                 |                                |
+------------------+--------------------------------+
```

### 2.2 响应式设计
- 桌面端（>1024px）：完整显示侧边栏
- 平板端（768px-1024px）：可收起的侧边栏
- 移动端（<768px）：抽屉式导航菜单

### 2.3 配色方案
- 主色: `#1976D2` (蓝色)
- 次要色: `#424242` (深灰)
- 强调色: `#FF4081` (粉色)
- 背景色: `#F5F5F5` (浅灰)
- 文字颜色:
  - 主要文字: `#212121`
  - 次要文字: `#757575`
  - 禁用文字: `#BDBDBD`

## 3. 页面设计

### 3.1 登录/注册页面
#### 登录页面
- 简洁的表单布局
- 输入字段:
  - 用户名/邮箱
  - 密码
  - 记住登录选项
- 错误提示信息显示
- 注册入口链接

#### 注册页面
- 分步表单:
  1. 基本信息（用户名、密码）
  2. 个人信息（姓名、邮箱）
  3. 角色选择（学生/教师）
- 表单验证提示
- 已有账号登录入口

### 3.2 仪表盘页面
```
+------------------+------------------+
|     CPU使用      |    内存使用      |
|    [图表卡片]    |   [图表卡片]     |
+------------------+------------------+
|    磁盘使用      |   虚拟机状态     |
|    [图表卡片]    |   [状态卡片]     |
+------------------+------------------+
|        最近使用的课程             |
|        [课程卡片列表]            |
+--------------------------------+
|        活动日志                 |
|        [时间线列表]            |
+--------------------------------+
```

### 3.3 课程页面
#### 课程列表
- 表格式布局
- 列信息:
  - 课程名称
  - 教师
  - 学生数量
  - 虚拟机数量
  - 创建时间
  - 操作按钮
- 分页控制
- 搜索和筛选

#### 课程详情
- 课程基本信息卡片
- 成员管理标签页
  - 学生列表
  - 教师列表
- 虚拟机模板标签页
- 资源使用统计

### 3.4 虚拟机页面
#### 虚拟机列表
```
+-------------------+-------------------+
|    虚拟机卡片1    |    虚拟机卡片2    |
+-------------------+-------------------+
|    虚拟机卡片3    |    虚拟机卡片4    |
+-------------------+-------------------+
```

每个虚拟机卡片包含：
- 状态指示器
- 基本信息（名称、IP等）
- 资源使用条
- 快速操作按钮（开机/关机/重启）
- 进入控制台按钮

#### 虚拟机详情
- 详细信息面板
- 实时监控图表
- 操作日志
- VNC控制台入口

### 3.5 VNC控制台页面
- 全屏显示区域
- 工具栏（可隐藏）
  - 断开连接
  - 重新连接
  - 发送Ctrl+Alt+Del
  - 全屏切换
- 键盘映射支持
- 剪贴板集成

## 4. 通用组件设计

### 4.1 导航组件
```
|- 应用栏
   |- 品牌标识
   |- 搜索框
   |- 用户菜单
|- 侧边导航
   |- 导航项
   |- 子菜单
```

### 4.2 数据表格组件
- 可选列显示
- 排序功能
- 过滤功能
- 分页控制
- 批量操作

### 4.3 表单组件
- 输入验证
- 错误提示
- 帮助文本
- 自动完成
- 文件上传

### 4.4 对话框组件
- 确认对话框
- 表单对话框
- 信息展示对话框
- 自定义操作按钮

### 4.5 通知组件
- 成功/错误/警告/信息通知
- 自动消失
- 可手动关闭
- 位置可配置

## 5. 业务组件设计

### 5.1 虚拟机状态卡片
```
+--------------------------------+
|          虚拟机名称            |
|--------------------------------|
| 状态指示器    CPU: 75%         |
|              内存: 2GB/4GB     |
|              磁盘: 20GB/50GB   |
|--------------------------------|
| [开机] [关机] [重启] [控制台]  |
+--------------------------------+
```

### 5.2 资源使用图表
- CPU使用率折线图
- 内存使用量面积图
- 磁盘I/O柱状图
- 网络流量双向图表

### 5.3 VNC控制台集成
- noVNC组件封装
- 快捷键处理
- 分辨率自适应
- 性能优化

### 5.4 文件上传组件
- 拖拽上传
- 进度显示
- 大文件分片上传
- 文件类型验证

## 6. API集成设计

### 6.1 API模块化
```
api/
  ├── index.js          # API配置和拦截器
  ├── modules/
  │   ├── auth.js       # 认证相关API
  │   ├── courses.js    # 课程管理API
  │   ├── vms.js        # 虚拟机管理API
  │   └── users.js      # 用户管理API
  └── interceptors/     # 请求/响应拦截器
```

### 6.2 认证相关API集成
| 组件/页面 | API路径 | 方法 | 用途 |
|----------|---------|------|------|
| 登录页面 | `/api/auth/login/` | POST | 用户登录 |
| 注册页面 | `/api/auth/register/` | POST | 用户注册 |
| 用户菜单 | `/api/auth/user/profile/` | GET | 获取个人信息 |

### 6.3 课程管理API集成
| 组件/页面 | API路径 | 方法 | 用途 |
|----------|---------|------|------|
| 课程列表 | `/api/courses/` | GET | 获取课程列表 |
| 课程详情 | `/api/courses/{id}/` | GET | 获取课程详情 |
| 课程成员管理 | `/api/courses/{id}/students/` | GET/POST/DELETE | 学生管理 |
| 模板管理 | `/api/courses/{id}/templates/` | GET/POST | 模板管理 |

### 6.4 虚拟机管理API集成
| 组件/页面 | API路径 | 方法 | 用途 |
|----------|---------|------|------|
| 虚拟机列表 | `/api/vms/` | GET | 获取虚拟机列表 |
| 虚拟机状态卡片 | `/api/vms/{id}/status/` | GET | 获取状态 |
| 资源监控图表 | `/api/vms/{id}/metrics/` | GET | 获取监控数据 |
| VNC控制台 | `/api/vms/{id}/console_vnc/` | GET | 获取VNC信息 |
| 虚拟机操作按钮 | `/api/vms/{id}/{action}/` | POST | 控制虚拟机 |

### 6.5 WebSocket集成
| 功能 | 订阅主题 | 用途 |
|------|---------|------|
| 虚拟机状态更新 | `vm.status.{id}` | 实时状态变化 |
| 资源监控数据 | `vm.metrics.{id}` | 性能指标推送 |
| 系统通知 | `notifications` | 全局通知推送 |

### 6.6 错误处理
- 统一的错误拦截器
- HTTP状态码处理
- 业务错误码处理
- 错误提示组件集成
- Token失效处理

### 6.7 请求/响应拦截
```javascript
// 请求拦截
axios.interceptors.request.use(config => {
  // 添加认证Token
  if (store.state.auth.token) {
    config.headers.Authorization = `Bearer ${store.state.auth.token}`;
  }
  return config;
});

// 响应拦截
axios.interceptors.response.use(
  response => response,
  error => {
    if (error.response.status === 401) {
      // Token失效，跳转登录
      router.push('/login');
    }
    // 显示错误提示
    showError(error.response.data.error);
    return Promise.reject(error);
  }
);
```

## 7. 状态管理设计

### 7.1 Vuex Store结构
```
store/
  ├── index.js          # 根store
  ├── modules/
  │   ├── auth/         # 认证相关
  │   ├── courses/      # 课程管理
  │   ├── vms/          # 虚拟机管理
  │   └── users/        # 用户管理
  └── plugins/          # Vuex插件
```

### 6.2 WebSocket集成
- 虚拟机状态实时更新
- 资源使用数据推送
- 系统通知推送
- 断线重连机制

## 7. 路由设计

```javascript
routes: [
  {
    path: '/login',
    component: Login
  },
  {
    path: '/dashboard',
    component: Dashboard
  },
  {
    path: '/courses',
    component: CourseList
  },
  {
    path: '/courses/:id',
    component: CourseDetail
  },
  {
    path: '/vms',
    component: VMList
  },
  {
    path: '/vms/:id',
    component: VMDetail
  },
  {
    path: '/vms/:id/console',
    component: VNCConsole
  }
]
```
